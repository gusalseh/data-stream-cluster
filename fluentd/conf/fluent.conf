<source>
  @type tail
  path /fluentd/log/ai_data.json
  pos_file /fluentd/log/ai_data.pos
  tag ai.json
  format json
  read_from_head true  # 기존 파일 처음부터 처리
</source>

<filter ai.json>
  @type record_transformer
  enable_ruby true

  <record>
    topic ${if record["result"] == "positive" then "positive_topic" elsif record["result"] == "negative" then "negative_topic" else "others_topic" end}
  </record>
</filter>

<match ai.json>
  @type kafka
  brokers kafka:9092

  # topic_key로 레코드 내 'topic' 필드를 사용
  topic_key topic

  # 혹시 레코드에 'topic' 필드가 없을 경우 fallback
  default_topic others_topic

  output_data_type json
</match>